import{u as T,h as D,r as i,j as a,b as M}from"./index-CiYObJ11.js";import{t as W}from"./api-BeJd8zh7.js";const k=o=>{const r=(o||"").toLowerCase().trim();return r?r.includes("fuerza")&&r.includes("resistencia")?"fuerza_resistencia":r.includes("resistencia")&&r.includes("cardio")?"resistencia_cardio":r.includes("quema")&&r.includes("grasa")?"quema_grasa":r.includes("est√©tica")||r.includes("estetica")?"estetica_salud":r.includes("hipertrofia")?"hipertrofia":r.includes("potencia")?"potencia":r.includes("movilidad")?"movilidad":r.includes("fuerza")?"fuerza":r.includes("resistencia")?"resistencia":r:""},g=[{value:"fuerza",label:"Fuerza",icon:"üí™"},{value:"hipertrofia",label:"Hipertrofia",icon:"üèãÔ∏è"},{value:"resistencia",label:"Resistencia",icon:"üèÉ"},{value:"potencia",label:"Potencia",icon:"‚ö°"},{value:"movilidad",label:"Movilidad",icon:"üßò"},{value:"quema_grasa",label:"Quema de Grasa",icon:"üî•"},{value:"estetica_salud",label:"Est√©tica y Salud",icon:"‚ú®"},{value:"fuerza_resistencia",label:"Fuerza y Resistencia",icon:"üí™üèÉ"},{value:"resistencia_cardio",label:"Resistencia y Cardio",icon:"üèÉ‚ù§Ô∏è"}],q=()=>{const o=T(),r=D(),[N,y]=i.useState(!1),[f,C]=i.useState(null),[c,F]=i.useState([]),[u,w]=i.useState(""),[n,v]=i.useState(null),[m,E]=i.useState(""),[p,R]=i.useState(""),[h,L]=i.useState(""),[x,P]=i.useState("alphabetical");i.useEffect(()=>{(async()=>{y(!0),C(null);try{let s=[];try{s=((await W.getRoutines())?.data||[]).map(t=>({id:t.id,name:t.name,description:t.description,trainingObjective:t.trainingObjective||t.objective,level:t.level||t.difficulty,gender:t.gender,daysPerWeek:t.daysPerWeek,type:"personal"}))}catch(d){console.warn("No se pudieron cargar rutinas personales:",d)}let l=[];try{l=((await M.get("/routine-templates",{params:{includePresets:"true"}}))?.data?.data||[]).map(t=>({id:t.id,name:t.name,description:t.description,trainingObjective:t.trainingObjective,level:t.level,gender:t.gender,daysPerWeek:t.daysPerWeek,type:"preset"}))}catch(d){throw console.error("Error cargando rutinas predise√±adas:",d?.response?.data||d),new Error(d?.response?.data?.message||"Error al cargar rutinas predise√±adas")}F([...s,...l])}catch(s){C(s.message||"Error al cargar la Biblioteca de Rutinas")}finally{y(!1)}})()},[]),i.useEffect(()=>{const e=r.state?.folder;if(e){const s=g.find(l=>l.value===e);s&&v(s)}},[r.state]);const A=i.useMemo(()=>{const e=new Set;return c.forEach(s=>{s.level&&e.add((s.level||"").toLowerCase())}),Array.from(e).map(s=>({value:s,label:s.charAt(0).toUpperCase()+s.slice(1)}))},[c]),O=i.useMemo(()=>{const e=new Set;return c.forEach(s=>{s.gender&&e.add(s.gender)}),Array.from(e).map(s=>({value:s,label:s.charAt(0).toUpperCase()+s.slice(1)}))},[c]),j=i.useMemo(()=>{const e={};return g.forEach(s=>{e[s.value]=0}),c.forEach(s=>{const l=k(s.trainingObjective);l&&(e[l]=(e[l]||0)+1)}),e},[c]),z=i.useMemo(()=>{const e=[...g];return x==="alphabetical"?e.sort((s,l)=>s.label.localeCompare(l.label,"es")):e.sort((s,l)=>(j[l.value]||0)-(j[s.value]||0))},[x,j]),S=i.useMemo(()=>{let e=c;if(n&&(e=e.filter(s=>k(s.trainingObjective)===n.value)),u){const s=u.toLowerCase();e=e.filter(l=>(l.name||"").toLowerCase().includes(s)||(l.description||"").toLowerCase().includes(s))}return m&&(e=e.filter(s=>(s.level||"").toLowerCase()===m.toLowerCase())),p&&(e=e.filter(s=>(s.gender||"")===p)),h&&(e=e.filter(s=>s.type===h)),e},[c,n,u,m,p,h]),b=()=>{w(""),E(""),R(""),L("")};return a.jsxs("div",{className:"routine-library-page",children:[a.jsxs("header",{className:"library-header tf-header-gradient",children:[a.jsxs("div",{className:"header-left",children:[a.jsxs("button",{className:"back-btn",onClick:()=>{n?(v(null),b()):o("/trainer-dashboard")},children:["‚Üê ",n?"Volver a la biblioteca":"Volver al dashboard"]}),a.jsxs("div",{className:"title-wrap",children:[a.jsx("h1",{className:"page-title",children:"Biblioteca de Rutinas"}),a.jsx("p",{className:"page-subtitle",children:"Explora carpetas por objetivo y filtra din√°micamente"})]})]}),n&&a.jsx("button",{className:"clear-btn",onClick:()=>{v(null),b()},children:"Cerrar carpeta"})]}),a.jsx("div",{className:"library-content",children:n?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"folder-header",children:[a.jsxs("div",{className:"folder-badge",children:[a.jsx("span",{className:"folder-emoji","aria-hidden":!0,children:n.icon}),a.jsx("span",{className:"folder-label",children:n.label})]}),a.jsxs("div",{className:"filters-row",children:[a.jsx("input",{type:"text",className:"search-input",placeholder:"Buscar rutinas...",value:u,onChange:e=>w(e.target.value)}),a.jsxs("select",{className:"filter-select",value:m,onChange:e=>E(e.target.value),children:[a.jsx("option",{value:"",children:"Todos los niveles"}),A.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))]}),a.jsxs("select",{className:"filter-select",value:p,onChange:e=>R(e.target.value),children:[a.jsx("option",{value:"",children:"Todos"}),O.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))]}),a.jsxs("select",{className:"filter-select",value:h,onChange:e=>L(e.target.value),children:[a.jsx("option",{value:"",children:"Todas"}),a.jsx("option",{value:"preset",children:"Predise√±ada"}),a.jsx("option",{value:"personal",children:"Personal"})]}),(m||p||h||u)&&a.jsx("button",{className:"clear-filters",onClick:b,children:"Limpiar filtros"})]})]}),N?a.jsxs("div",{className:"loading-container",children:[a.jsx("div",{className:"loading-spinner"})," Cargando rutinas..."]}):f?a.jsx("div",{className:"error-container",children:a.jsx("span",{className:"error-text",children:f})}):S.length===0?a.jsx("div",{className:"empty-state",children:"No se encontraron rutinas para estos filtros."}):a.jsx("div",{className:"routines-grid",children:S.map(e=>a.jsxs("div",{className:"routine-card tf-card",children:[a.jsx("div",{className:"routine-title gradient-text",children:e.name}),a.jsxs("div",{className:"routine-meta",children:[e.level&&a.jsxs("span",{className:"meta-chip",children:["Nivel: ",e.level]}),e.gender&&a.jsxs("span",{className:"meta-chip",children:["G√©nero: ",e.gender]}),typeof e.daysPerWeek=="number"&&a.jsxs("span",{className:"meta-chip",children:[e.daysPerWeek," d√≠as/sem"]}),a.jsx("span",{className:"meta-chip type-chip",children:e.type==="preset"?"Predise√±ada":"Personal"})]}),e.description&&a.jsx("p",{className:"routine-desc",children:e.description}),a.jsx("div",{className:"routine-actions",children:e.type==="preset"?a.jsx("button",{className:"tf-btn tf-btn-primary",onClick:()=>o("/trainer/create-routine",{state:{presetRoutine:e,fromLibrary:!0,folder:n?.value}}),children:"Usar Rutina"}):a.jsx("button",{className:"tf-btn tf-btn-secondary",onClick:()=>o(`/trainer/routines/${e.id}`,{state:{fromLibrary:!0,folder:n?.value}}),children:"Ver"})})]},`${e.type}-${e.id}`))})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"sort-row",children:[a.jsx("span",{className:"sort-label",children:"Ordenar por:"}),a.jsxs("select",{className:"filter-select sort-select",value:x,onChange:e=>P(e.target.value),children:[a.jsx("option",{value:"alphabetical",children:"Alfab√©tico"}),a.jsx("option",{value:"frequency",children:"Frecuencia"})]})]}),a.jsx("div",{className:"folders-grid",children:z.map(e=>a.jsxs("button",{className:"folder-card tf-card",onClick:()=>v(e),children:[a.jsx("div",{className:"folder-icon","aria-hidden":!0,children:e.icon}),a.jsxs("div",{className:"folder-info",children:[a.jsx("div",{className:"folder-title gradient-text",children:e.label}),a.jsxs("div",{className:"folder-count",children:[j[e.value]||0," rutinas"]})]}),a.jsx("div",{className:"folder-arrow","aria-hidden":!0,children:"‚Üí"})]},e.value))}),a.jsxs("div",{className:"library-cta-row",children:[a.jsx("button",{className:"tf-btn tf-btn-primary cta-btn",onClick:()=>o("/trainer/routines"),children:"Ver todas las rutinas"}),a.jsx("button",{className:"tf-btn tf-btn-primary cta-btn",onClick:()=>o("/trainer/create-routine"),children:"Agregar nueva categor√≠a"})]}),N&&a.jsxs("div",{className:"loading-container",children:[a.jsx("div",{className:"loading-spinner"})," Cargando rutinas..."]}),f&&a.jsx("div",{className:"error-container",children:a.jsx("span",{className:"error-text",children:f})})]})}),a.jsx("footer",{className:"library-footer",children:a.jsx("p",{className:"footer-note",children:"Agrup√° tus rutinas por objetivo para mantener tu biblioteca ordenada"})})]})};export{q as default};
